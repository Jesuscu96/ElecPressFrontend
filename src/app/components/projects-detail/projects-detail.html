<section class="page">

  <div class="header">
    <div class="header__left">
      <h1>Detalle de Proyecto</h1>
    </div>

    <div class="header__right">
      <button class="btn" type="button" (click)="loadProject()" [disabled]="loadingProjects">Recargar</button>
      <a class="btn" [routerLink]="['/dashboard/projects']">Volver</a>
    </div>
  </div>

  <div class="alert alert--error" *ngIf="errorMsg">
    {{ errorMsg }}
    <button class="alert__close" type="button" (click)="errorMsg=''">×</button>
  </div>

  <div class="alert alert--ok" *ngIf="successMsg">
    {{ successMsg }}
    <button class="alert__close" type="button" (click)="successMsg=''">×</button>
  </div>

  <div class="loading" *ngIf="loadingProjects"></div>

  
  <div class="card projects-card" *ngIf="project && !loadingProjects">
    <div class="card__header">
      <h2>Información</h2>
    </div>

    <div class="detail-grid">
      <div><b>Proyecto:</b> {{ project.name }}</div>
      <div><b>Cliente:</b> {{ project.client_name || '-' }}</div>
      <div><b>Presupuesto:</b> {{ project.budget }}</div>
      <div><b>Status:</b> {{ project.status }}</div>
      <div><b>Creado:</b> {{ project.created_at | date:'dd/MM/yyyy' }}</div>
    </div>
  </div>
  

 
   <div class="card projects-card">
    <div class="card__header">
      <h2>Users asignados</h2>
    </div>

    <div class="loading" *ngIf="loadingUsers"></div>

    <div class="table-wrap" *ngIf="!loadingUsers">
      <table class="table" *ngIf="users.length; else emptyUsers">
        <thead>
          <tr>
            <th>Nombre</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let u of users">
            <td>{{ u.user_name }}</td>
          </tr>
        </tbody>
      </table>

      <ng-template #emptyUsers>
        <p class="muted">No hay users asignados.</p>
      </ng-template>
    </div>
  </div>


  <div class="card projects-card">
    <div class="card__header">
      <h2>Materiales</h2>
    </div>

    <div class="loading" *ngIf="loadingMaterials"></div>

    <div class="table-wrap" *ngIf="!loadingMaterials">
      <table class="table" *ngIf="materials.length; else emptyMaterials">
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Material</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let m of materials">
            <td>
              <img *ngIf="m.material_image" class="thumb" [src]="m.material_image" alt="img">
              <span *ngIf="!m.material_image">-</span>
            </td>
            <td>{{ m.material_name }}</td>
            <td>{{ m.material_quantity }}</td>
          </tr>
        </tbody>
      </table>

      <ng-template #emptyMaterials>
        <p class="muted">No hay materiales asignados.</p>
      </ng-template>
    </div>
  </div>

  
  <div class="card projects-card">
    <div class="card__header">
      <h2>Equipment</h2>
    </div>

    <div class="loading" *ngIf="loadingEquipment"></div>

    <div class="table-wrap" *ngIf="!loadingEquipment">
      <table class="table" *ngIf="equipments.length; else emptyEquipment">
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Equipo</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let e of equipments">
            <td>
              <img *ngIf="e.equipment_image" class="thumb" [src]="e.equipment_image" alt="img">
              <span *ngIf="!e.equipment_image">-</span>
            </td>
            <td>{{ e.equipment_name }}</td>
            <td>{{ e.quantity || '-' }}</td>
          </tr>
        </tbody>
      </table>

      <ng-template #emptyEquipment>
        <p class="muted">No hay equipment asignado.</p>
      </ng-template>
    </div>
  </div>

</section>