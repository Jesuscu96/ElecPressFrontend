<section class="page">

  <div class="header">
    <div class="header__left">
      <h1>Detalle de Proyecto</h1>
    </div>

    <div class="header__right">
      <button class="btn" type="button" (click)="loadAll()" [disabled]="loading">Recargar</button>
      <a class="btn" [routerLink]="['/dashboard/projects']">Volver</a>
    </div>
  </div>

  <div class="alert alert--error" *ngIf="errorMsg">
    {{ errorMsg }}
    <button class="alert__close" type="button" (click)="errorMsg=''">×</button>
  </div>

  <div class="alert alert--ok" *ngIf="successMsg">
    {{ successMsg }}
    <button class="alert__close" type="button" (click)="successMsg=''">×</button>
  </div>

  <div class="loading" *ngIf="loading"></div>

  
  <div class="card clients-card" *ngIf="project && !loading">
    <div class="card__header">
      <h2>Información</h2>
    </div>

    <div class="detail-grid">
      <div><b>Proyecto:</b> {{ project.name }}</div>
      <div><b>Cliente:</b> {{ project.client_name || '-' }}</div>
      <div><b>Presupuesto:</b> {{ project.budget || '-' }}</div>
      <div><b>Status:</b> {{ project.status }}</div>
      <div><b>Creado:</b> {{ project.created_at }}</div>
    </div>
  </div>

 
  <h2>Usuarios asignados</h2>
  <div class="table-wrap">
    <table class="table" *ngIf="users.length && !loading; else emptyUsers">
      <thead>
        <tr>
          <th>Usuario</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of users">
          <td>{{ u.user_name }}</td>
        </tr>
      </tbody>
    </table>

    <ng-template #emptyUsers>
      <p class="muted" *ngIf="!loading">No hay usuarios asignados.</p>
    </ng-template>
  </div>

  
  <h2>Materiales</h2>
  <div class="table-wrap">
    <table class="table" *ngIf="materials.length && !loading; else emptyMaterials">
      <thead>
        <tr>
          <th>Imagen</th>
          <th>Material</th>
          <th>Cantidad</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of materials">
          <td>
            <img *ngIf="m.material_image" [src]="m.material_image" alt="material" class="thumb">
            <span *ngIf="!m.material_image">-</span>
          </td>
          <td>{{ m.material_name }}</td>
          <td>{{ m.material_quantity }}</td>
        </tr>
      </tbody>
    </table>

    <ng-template #emptyMaterials>
      <p class="muted" *ngIf="!loading">No hay materiales asignados.</p>
    </ng-template>
  </div>

  
  <h2>Equipamiento</h2>
  <div class="table-wrap">
    <table class="table" *ngIf="equipments.length && !loading; else emptyEquip">
      <thead>
        <tr>
          <th>Imagen</th>
          <th>Equipo</th>
          <th>Cantidad</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let e of equipments">
          <td>
            <img *ngIf="e.equipment_image" [src]="e.equipment_image" alt="equipo" class="thumb">
            <span *ngIf="!e.equipment_image">-</span>
          </td>
          <td>{{ e.equipment_name }}</td>
          <td>{{ e.quantity }}</td>
        </tr>
      </tbody>
    </table>

    <ng-template #emptyEquip>
      <p class="muted" *ngIf="!loading">No hay equipamiento asignado.</p>
    </ng-template>
  </div>

</section>

